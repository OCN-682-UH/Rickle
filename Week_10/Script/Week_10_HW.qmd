---
title: "Week 10 Homework"
author: "SZR"
format: 
  html:
    toc: true
    code-fold: true
---
This script demonstrates how to use functions

# Load Libraries
```{r}
#| message: false

library(here)
library(ggplot2)
library(dplyr)
library(stringr)
```

# Load Data
This is a subset of data from a survey of Clarion Clipperton Zone mesopelagic micronekton. The data included only the targeted species I will be evaluating for diet analysis for my thesis.
```{r}
#| message: false

ccz_micronekton <- read.csv(here("Week_10", "Data", "ccz_target_cleaned.csv"))
```

# Functions

## Making a function

This function allows you to to type the in the sample number and obtain the sample info including **n**, the cruise number as **Spring or Fall**, and **depth range** of collection
```{r}
#| message: false

sample_info <-  function(sample_number, data) { ## setting function input to sample #
  result <- data[data$Sample.. %in% sample_number, ## setting the result to the selected sample information
                 c("LTU", "n", "Cruise.Number", "Site", "depth_range_m")]
  if (nrow(result) == 0) {
    return("Sample number not found")
  } ## to display if no corresponding sample number
  result$Cruise.Number <- ifelse(result$Cruise.Number == "DG5B", "Spring",
                          ifelse(result$Cruise.Number == "DG5C", "Fall",
                                 result$Cruise.Number))
  rownames(result) <- NULL
  return(result)
}
```

### Example 1
```{r}
sample_info(3, ccz_micronekton)
```
This example shows what it looks like when there are multiple records associated with a sample number

### Example 2
```{r}
sample_info(c(3, 5, 6), ccz_micronekton)
```

This example shows what it looks like when you input multiple sample numbers



## Making a function from a graph

*Attempting* to make a function where you provide the species name and it generates a **barplot of n for each depth**
```{r}
plot_species_bar <- function(species_name, data = ccz_micronekton) {
  # normalize depth labels and make an ordered factor
  dat <- data %>%
    mutate(
      depth_range_m = str_replace_all(as.character(depth_range_m), "-", "–") |> str_trim(),
      n = as.numeric(n)
    ) %>%
    filter(LTU == species_name, !is.na(depth_range_m), !is.na(n))

  # create ordered factor for depths
  depth_levels <- dat %>%
    distinct(depth_range_m) %>%
    mutate(low = as.numeric(sub("–.*", "", depth_range_m))) %>%
    arrange(low) %>%
    pull(depth_range_m)

  # summarize total count per depth range
  dat_sum <- dat %>%
    group_by(depth_range_m) %>%
    summarise(total_n = sum(n, na.rm = TRUE), .groups = "drop") %>%
    mutate(depth_range_m = factor(depth_range_m, levels = depth_levels))

  # make bar plot
  ggplot(dat_sum, aes(x = depth_range_m, y = total_n, fill = depth_range_m)) +
    geom_bar(stat = "identity", width = 0.7, color = "white", show.legend = FALSE) +
    scale_fill_brewer(palette = "PuBu") +
    labs(
      title = paste("Depth Distribution of", species_name),
      x = "Depth range (m)",
      y = "Total count (n)"
    ) +
    theme_minimal(base_family = "Helvetica") +
    theme(
      plot.title = element_text(size = 16, face = "bold"),
      axis.title = element_text(size = 13),
      axis.text = element_text(size = 11)
    )
}
```

## Example 3
```{r}
# Example:
plot_species_bar("Diogenicthys laternatus")
```
This example shows us presence of Diogenichthys laternatus across all depths

### Example 4
```{r}
plot_species_bar("Diaphus pacificus")
```
This example shows us presence of Diaphus pacificus across only some depths.


